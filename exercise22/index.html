<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Exercise 22 - Software Defined Infrastructure Group 2</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Exercise 22";
        var mkdocs_page_input_path = "exercise22.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Software Defined Infrastructure Group 2
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Manual Server Management</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise01/">Exercise 1</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise02/">Exercise 2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise03/">Exercise 3</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise04/">Exercise 4</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise05/">Exercise 5</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise06/">Exercise 6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise07/">Exercise 7</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise08/">Exercise 8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise09/">Exercise 9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise10/">Exercise 10</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cloud Provider</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../exercise11/">Exercise 11</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise12/">Exercise 12</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise13/">Exercise 13</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise14/">Exercise 14</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise15/">Exercise 15</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise16/">Exercise 16</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise17/">Exercise 17</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise18/">Exercise 18</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise19/">Exercise 19</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise20/">Exercise 20</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise21/">Exercise 21</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Exercise 22</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#_1"></a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise23/">Exercise 23</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise24/">Exercise 24</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise25/">Exercise 25</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercise26/">Exercise 26</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Software Defined Infrastructure Group 2</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Cloud Provider</li>
      <li class="breadcrumb-item active">Exercise 22</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="exercise-22-creating-a-web-certificate">Exercise 22: Creating a web certificate</h1>
<blockquote>
<p>Click <a href="https://github.com/DWalz/sdi-25/tree/main/exercise22">here</a> to view the solution in the repository.</p>
<p><em>Note:</em> The exercises 22 to 24 have been solved inside one configuration</p>
</blockquote>
<p>The <code>acme</code> provider is used in Terraform to request certificates from different certificate servers implementing the ACME protocol.
To initialize the provider a server as well as a registration with that server is required:</p>
<pre class="highlight"><code class="language-tf">provider "acme" {
  server_url = "https://acme-staging-v02.api.letsencrypt.org/directory"
  # server_url = "https://acme-v02.api.letsencrypt.org/directory"
}

resource "tls_private_key" "acme_account_private_key" {
  algorithm = "RSA"
}

resource "acme_registration" "registration" {
  email_address   = "dw084@hdm-stuttgart.de"
  account_key_pem = tls_private_key.acme_account_private_key.private_key_pem
}</code></pre>
<p>The <code>acme_certificate</code> resource can then be used to request a certificate from that server.
To do so the name of the domain that the certificate is registered to (in this case <code>*.g2.sdi.hdm-stuttgart.cloud</code>) needs to be provided as well as any alternative names (in this case the zone domain <code>g2.hdm-stuttgart.cloud</code>).</p>
<p>The <code>dns_challenge</code> argument can be used to provide a DNS challenge in which the <em>Let's encrypt</em> server ensures that the necessary DNS entries are present in the DNS server before validating the certificate:</p>
<pre class="highlight"><code class="language-tf">resource "acme_certificate" "wildcard_certificate" {
  account_key_pem           = acme_registration.registration.account_key_pem
  common_name               = "*.${var.dns_server_domain}"
  subject_alternative_names = [var.dns_server_domain]

  dns_challenge {
    provider = "rfc2136"
    config = {
      RFC2136_NAMESERVER     = "ns1.sdi.hdm-stuttgart.cloud"
      RFC2136_TSIG_ALGORITHM = "hmac-sha512"
      RFC2136_TSIG_KEY       = "g2.key."
      RFC2136_TSIG_SECRET    = var.dns_secret_key
    }
  }
}</code></pre>
<p>After the certificate has been created the values from it are used to save them to the <code>gen</code> folder in order to use them later (e.g. when applying them to a web server):</p>
<pre class="highlight"><code class="language-tf">resource "local_file" "tls_private_key" {
  filename        = "./gen/private.pem"
  content         = acme_certificate.wildcard_certificate.private_key_pem
}

resource "local_file" "tls_certificate_key" {
  filename        = "./gen/certificate.pem"
  content         = acme_certificate.wildcard_certificate.certificate_pem
}</code></pre>
<p>dwalz@dwolf:/mnt/d/Development/hdm/ss25/sdi/exercise22/configuration$ ./bin/ssh.sh
Linux exercise-20 6.1.0-37-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.140-1 (2025-05-22) x86_64</p>
<p>The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.</p>
<p>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
devops@exercise-20:~$ nano /etc/nginx/sites-available/default
devops@exercise-20:~$ sudo nano /etc/nginx/sites-available/default
devops@exercise-20:~$
devops@exercise-20:~$ sudo nano /etc/nginx/sites-available/default
devops@exercise-20:~$ cat /etc/nginx/sites-available/default</p>
<h2 id="_1"></h2>
<h1 id="you-should-look-at-the-following-urls-in-order-to-grasp-a-solid-understanding">You should look at the following URL's in order to grasp a solid understanding</h1>
<h1 id="of-nginx-configuration-files-in-order-to-fully-unleash-the-power-of-nginx">of Nginx configuration files in order to fully unleash the power of Nginx.</h1>
<h1 id="httpswwwnginxcomresourceswikistart">https://www.nginx.com/resources/wiki/start/</h1>
<h1 id="httpswwwnginxcomresourceswikistarttopicstutorialsconfig_pitfalls">https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/</h1>
<h1 id="httpswikidebianorgnginxdirectorystructure">https://wiki.debian.org/Nginx/DirectoryStructure</h1>
<h1 id="_2"></h1>
<h1 id="in-most-cases-administrators-will-remove-this-file-from-sites-enabled-and">In most cases, administrators will remove this file from sites-enabled/ and</h1>
<h1 id="leave-it-as-reference-inside-of-sites-available-where-it-will-continue-to-be">leave it as reference inside of sites-available where it will continue to be</h1>
<h1 id="updated-by-the-nginx-packaging-team">updated by the nginx packaging team.</h1>
<h1 id="_3"></h1>
<h1 id="this-file-will-automatically-load-configuration-files-provided-by-other">This file will automatically load configuration files provided by other</h1>
<h1 id="applications-such-as-drupal-or-wordpress-these-applications-will-be-made">applications, such as Drupal or Wordpress. These applications will be made</h1>
<h1 id="available-underneath-a-path-with-that-package-name-such-as-drupal8">available underneath a path with that package name, such as /drupal8.</h1>
<h1 id="_4"></h1>
<h1 id="please-see-usrsharedocnginx-docexamples-for-more-detailed-examples">Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.</h1>
<h2 id="_5"></h2>
<h1 id="default-server-configuration">Default server configuration</h1>
<h1 id="_6"></h1>
<p>server {
        listen 80 default_server;
        listen [::]:80 default_server;</p>
<pre><code>    # SSL configuration
    #
    listen 443 ssl default_server;
    listen [::]:443 ssl default_server;
    #
    # Note: You should disable gzip for SSL traffic.
    # See: https://bugs.debian.org/773332
    #
    # Read up on ssl_ciphers to ensure a secure configuration.
    # See: https://bugs.debian.org/765782
    #
    # Self signed certs generated by the ssl-cert package
    # Don't use them in a production server!
    #
    include snippets/snakeoil.conf;

    root /var/www/html;

    # Add index.php to the list if you are using PHP
    index index.html index.htm index.nginx-debian.html;

    server_name _;

    location / {
            # First attempt to serve request as file, then
            # as directory, then fall back to displaying a 404.
            try_files $uri $uri/ =404;
    }

    # pass PHP scripts to FastCGI server
    #
    #location ~ \.php$ {
    #       include snippets/fastcgi-php.conf;
    #
    #       # With php-fpm (or other unix sockets):
    #       fastcgi_pass unix:/run/php/php7.4-fpm.sock;
    #       # With php-cgi (or other tcp sockets):
    #       fastcgi_pass 127.0.0.1:9000;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #       deny all;
    #}
</code></pre>
<p>}</p>
<h1 id="virtual-host-configuration-for-examplecom">Virtual Host configuration for example.com</h1>
<h1 id="_7"></h1>
<h1 id="you-can-move-that-to-a-different-file-under-sites-available-and-symlink-that">You can move that to a different file under sites-available/ and symlink that</h1>
<h1 id="to-sites-enabled-to-enable-it">to sites-enabled/ to enable it.</h1>
<h1 id="_8"></h1>
<h1 id="server">server {</h1>
<h1 id="listen-80">listen 80;</h1>
<h1 id="listen-80_1">listen [::]:80;</h1>
<h1 id="_9"></h1>
<h1 id="server_name-examplecom">server_name example.com;</h1>
<h1 id="_10"></h1>
<h1 id="root-varwwwexamplecom">root /var/www/example.com;</h1>
<h1 id="index-indexhtml">index index.html;</h1>
<h1 id="_11"></h1>
<h1 id="location">location / {</h1>
<h1 id="try_files-uri-uri-404">try_files $uri $uri/ =404;</h1>
<h1 id="_12">}</h1>
<h1 id="_13">}</h1>
<p>devops@exercise-20:~$ sudo nano /etc/nginx/sites-available/default exit
devops@exercise-20:~$ exit
logout
Connection to workhorse.g2.sdi.hdm-stuttgart.cloud closed.
dwalz@dwolf:/mnt/d/Development/hdm/ss25/sdi/exercise22/configuration$ terraform plan
tls_private_key.server_ssh_key: Refreshing state... [id=001145e64304fd2ef3d3402f497542231dcc96ed]
tls_private_key.acme_account_private_key: Refreshing state... [id=2c9bc6706ac1d22961dbbb31a3b2b3638ea4e294]
hcloud_volume.volume_exercise_20: Refreshing state... [id=103002948]
acme_registration.registration: Refreshing state... [id=https://acme-staging-v02.api.letsencrypt.org/acme/acct/217641194]
hcloud_firewall.fw_exercise_20: Refreshing state... [id=2324824]
module.ssh_wrapper.local_file.known_hosts: Refreshing state... [id=1315fc3b30c617cd2e3ce7b1fddb6e6b88006ede]
local_file.tls_private_key: Refreshing state... [id=5c060afea8ae9ca731ee668e0ddc8d436b546d17]
module.ssh_wrapper.local_file.ssh_bin: Refreshing state... [id=5ccf6ad6761693d2aa3b428cd2c14e518478a09f]
module.ssh_wrapper.local_file.scp_bin: Refreshing state... [id=ecdfc0a87ce70109ab9805b8678e1d8197022680]
dns_cname_record.exercise_dns_alias_records["www"]: Refreshing state... [id=www.g2.sdi.hdm-stuttgart.cloud.]
dns_cname_record.exercise_dns_alias_records["mail"]: Refreshing state... [id=mail.g2.sdi.hdm-stuttgart.cloud.]
acme_certificate.wildcard_certificate: Refreshing state... [id=7dc08b28-8dc7-8590-9bb3-2ccabdb791ba]
local_file.tls_certificate_key: Refreshing state... [id=98628dcfa94d2a652b2b399b00fef103baf8bded]
local_file.cloud_init: Refreshing state... [id=923a23b97f6dc5e555699ae9515c52886329bb01]
hcloud_server.exercise_20: Refreshing state... [id=105771291]
hcloud_volume_attachment.exercise_volume_attachment: Refreshing state... [id=103002948]
hcloud_firewall_attachment.exercise_fw_attachment: Refreshing state... [id=2324824]
dns_a_record_set.exercise_dns_name_record: Refreshing state... [id=workhorse.g2.sdi.hdm-stuttgart.cloud.]
dns_a_record_set.exercise_dns_base_record: Refreshing state... [id=g2.sdi.hdm-stuttgart.cloud.]</p>
<p>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  ~ update in-place
-/+ destroy and then create replacement</p>
<p>Terraform will perform the following actions:</p>
<p># dns_a_record_set.exercise_dns_base_record will be updated in-place
  ~ resource "dns_a_record_set" "exercise_dns_base_record" {
      ~ addresses = [
          - "95.216.223.223",
        ] -&gt; (known after apply)
        id        = "g2.sdi.hdm-stuttgart.cloud."
        # (2 unchanged attributes hidden)
    }</p>
<p># dns_a_record_set.exercise_dns_name_record will be updated in-place
  ~ resource "dns_a_record_set" "exercise_dns_name_record" {
      ~ addresses = [
          - "95.216.223.223",
        ] -&gt; (known after apply)
        id        = "workhorse.g2.sdi.hdm-stuttgart.cloud."
        name      = "workhorse"
        # (2 unchanged attributes hidden)
    }</p>
<p># hcloud_firewall_attachment.exercise_fw_attachment will be replaced due to changes in replace_triggered_by
-/+ resource "hcloud_firewall_attachment" "exercise_fw_attachment" {
      ~ id              = "2324824" -&gt; (known after apply)
      - label_selectors = [] -&gt; null
      ~ server_ids      = [
          - 105771291,
        ] -&gt; (known after apply)
        # (1 unchanged attribute hidden)
    }</p>
<p># hcloud_server.exercise_20 must be replaced
-/+ resource "hcloud_server" "exercise_20" {
      + backup_window              = (known after apply)
      ~ datacenter                 = "hel1-dc2" -&gt; (known after apply)
      ~ firewall_ids               = [
          - 2324824,
        ] -&gt; (known after apply)
      ~ id                         = "105771291" -&gt; (known after apply)
      ~ ipv4_address               = "95.216.223.223" -&gt; (known after apply)
      ~ ipv6_address               = "2a01:4f9:c013:e1a8::1" -&gt; (known after apply)
      ~ ipv6_network               = "2a01:4f9:c013:e1a8::/64" -&gt; (known after apply)
      - labels                     = {} -&gt; null
        name                       = "exercise-20"
      - placement_group_id         = 0 -&gt; null
      ~ primary_disk_size          = 40 -&gt; (known after apply)
      ~ status                     = "running" -&gt; (known after apply)
      ~ user_data                  = (sensitive value) # forces replacement
        # (10 unchanged attributes hidden)
    }</p>
<p># hcloud_volume_attachment.exercise_volume_attachment will be replaced due to changes in replace_triggered_by
-/+ resource "hcloud_volume_attachment" "exercise_volume_attachment" {
      ~ id        = "103002948" -&gt; (known after apply)
      ~ server_id = 105771291 -&gt; (known after apply) # forces replacement
        # (2 unchanged attributes hidden)
    }</p>
<p># local_file.cloud_init must be replaced
-/+ resource "local_file" "cloud_init" {
      ~ content              = (sensitive value) # forces replacement
      ~ content_base64sha256 = "yH7vuZ6QXui5Arp74m5Cd+UH6olTwf1FTw7+1iU0iC8=" -&gt; (known after apply)
      ~ content_base64sha512 = "7GRH9TjHKRwYEPH5eEjC8saDFnVGGGIo7HVqjxECaFSEZUX3sWGLpSBIvxPbYd2aTXIrRSMferzdz/syClxYSQ==" -&gt; (known after apply)
      ~ content_md5          = "0ff4cc438028c46636c28540146f5df5" -&gt; (known after apply)
      ~ content_sha1         = "923a23b97f6dc5e555699ae9515c52886329bb01" -&gt; (known after apply)
      ~ content_sha256       = "c87eefb99e905ee8b902ba7be26e4277e507ea8953c1fd454f0efed62534882f" -&gt; (known after apply)
      ~ content_sha512       = "ec6447f538c7291c1810f1f97848c2f2c683167546186228ec756a8f11026854846545f7b1618ba52048bf13db61dd9a4d722b45231f7abcddcffb320a5c5849" -&gt; (known after apply)
      ~ id                   = "923a23b97f6dc5e555699ae9515c52886329bb01" -&gt; (known after apply)
        # (3 unchanged attributes hidden)
    }</p>
<p>Plan: 4 to add, 2 to change, 4 to destroy.</p>
<p>Changes to Outputs:
  ~ server_datacenter = "hel1-dc2" -&gt; (known after apply)
  ~ server_ip         = "95.216.223.223" -&gt; (known after apply)</p>
<p>─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</p>
<p>Note: You didn't use the -out option to save this plan, so Terraform can't guarantee to take exactly these actions if you run "terraform apply" now.
dwalz@dwolf:/mnt/d/Development/hdm/ss25/sdi/exercise22/configuration$ terraform apply
dns_cname_record.exercise_dns_alias_records["www"]: Refreshing state... [id=www.g2.sdi.hdm-stuttgart.cloud.]
dns_cname_record.exercise_dns_alias_records["mail"]: Refreshing state... [id=mail.g2.sdi.hdm-stuttgart.cloud.]
hcloud_volume.volume_exercise_20: Refreshing state... [id=103002948]
hcloud_firewall.fw_exercise_20: Refreshing state... [id=2324824]
tls_private_key.acme_account_private_key: Refreshing state... [id=2c9bc6706ac1d22961dbbb31a3b2b3638ea4e294]
tls_private_key.server_ssh_key: Refreshing state... [id=001145e64304fd2ef3d3402f497542231dcc96ed]
acme_registration.registration: Refreshing state... [id=https://acme-staging-v02.api.letsencrypt.org/acme/acct/217641194]
local_file.tls_private_key: Refreshing state... [id=5c060afea8ae9ca731ee668e0ddc8d436b546d17]
module.ssh_wrapper.local_file.known_hosts: Refreshing state... [id=1315fc3b30c617cd2e3ce7b1fddb6e6b88006ede]
module.ssh_wrapper.local_file.scp_bin: Refreshing state... [id=ecdfc0a87ce70109ab9805b8678e1d8197022680]
module.ssh_wrapper.local_file.ssh_bin: Refreshing state... [id=5ccf6ad6761693d2aa3b428cd2c14e518478a09f]
acme_certificate.wildcard_certificate: Refreshing state... [id=7dc08b28-8dc7-8590-9bb3-2ccabdb791ba]
local_file.tls_certificate_key: Refreshing state... [id=98628dcfa94d2a652b2b399b00fef103baf8bded]
local_file.cloud_init: Refreshing state... [id=923a23b97f6dc5e555699ae9515c52886329bb01]
hcloud_server.exercise_20: Refreshing state... [id=105771291]
dns_a_record_set.exercise_dns_name_record: Refreshing state... [id=workhorse.g2.sdi.hdm-stuttgart.cloud.]
dns_a_record_set.exercise_dns_base_record: Refreshing state... [id=g2.sdi.hdm-stuttgart.cloud.]
hcloud_volume_attachment.exercise_volume_attachment: Refreshing state... [id=103002948]
hcloud_firewall_attachment.exercise_fw_attachment: Refreshing state... [id=2324824]</p>
<p>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  ~ update in-place
-/+ destroy and then create replacement</p>
<p>Terraform will perform the following actions:</p>
<p># dns_a_record_set.exercise_dns_base_record will be updated in-place
  ~ resource "dns_a_record_set" "exercise_dns_base_record" {
      ~ addresses = [
          - "95.216.223.223",
        ] -&gt; (known after apply)
        id        = "g2.sdi.hdm-stuttgart.cloud."
        # (2 unchanged attributes hidden)
    }</p>
<p># dns_a_record_set.exercise_dns_name_record will be updated in-place
  ~ resource "dns_a_record_set" "exercise_dns_name_record" {
      ~ addresses = [
          - "95.216.223.223",
        ] -&gt; (known after apply)
        id        = "workhorse.g2.sdi.hdm-stuttgart.cloud."
        name      = "workhorse"
        # (2 unchanged attributes hidden)
    }</p>
<p># hcloud_firewall_attachment.exercise_fw_attachment will be replaced due to changes in replace_triggered_by
-/+ resource "hcloud_firewall_attachment" "exercise_fw_attachment" {
      ~ id              = "2324824" -&gt; (known after apply)
      - label_selectors = [] -&gt; null
      ~ server_ids      = [
          - 105771291,
        ] -&gt; (known after apply)
        # (1 unchanged attribute hidden)
    }</p>
<p># hcloud_server.exercise_20 must be replaced
-/+ resource "hcloud_server" "exercise_20" {
      + backup_window              = (known after apply)
      ~ datacenter                 = "hel1-dc2" -&gt; (known after apply)
      ~ firewall_ids               = [
          - 2324824,
        ] -&gt; (known after apply)
      ~ id                         = "105771291" -&gt; (known after apply)
      ~ ipv4_address               = "95.216.223.223" -&gt; (known after apply)
      ~ ipv6_address               = "2a01:4f9:c013:e1a8::1" -&gt; (known after apply)
      ~ ipv6_network               = "2a01:4f9:c013:e1a8::/64" -&gt; (known after apply)
      - labels                     = {} -&gt; null
        name                       = "exercise-20"
      - placement_group_id         = 0 -&gt; null
      ~ primary_disk_size          = 40 -&gt; (known after apply)
      ~ status                     = "running" -&gt; (known after apply)
      ~ user_data                  = (sensitive value) # forces replacement
        # (10 unchanged attributes hidden)
    }</p>
<p># hcloud_volume_attachment.exercise_volume_attachment will be replaced due to changes in replace_triggered_by
-/+ resource "hcloud_volume_attachment" "exercise_volume_attachment" {
      ~ id        = "103002948" -&gt; (known after apply)
      ~ server_id = 105771291 -&gt; (known after apply) # forces replacement
        # (2 unchanged attributes hidden)
    }</p>
<p># local_file.cloud_init must be replaced
-/+ resource "local_file" "cloud_init" {
      ~ content              = (sensitive value) # forces replacement
      ~ content_base64sha256 = "yH7vuZ6QXui5Arp74m5Cd+UH6olTwf1FTw7+1iU0iC8=" -&gt; (known after apply)
      ~ content_base64sha512 = "7GRH9TjHKRwYEPH5eEjC8saDFnVGGGIo7HVqjxECaFSEZUX3sWGLpSBIvxPbYd2aTXIrRSMferzdz/syClxYSQ==" -&gt; (known after apply)
      ~ content_md5          = "0ff4cc438028c46636c28540146f5df5" -&gt; (known after apply)
      ~ content_sha1         = "923a23b97f6dc5e555699ae9515c52886329bb01" -&gt; (known after apply)
      ~ content_sha256       = "c87eefb99e905ee8b902ba7be26e4277e507ea8953c1fd454f0efed62534882f" -&gt; (known after apply)
      ~ content_sha512       = "ec6447f538c7291c1810f1f97848c2f2c683167546186228ec756a8f11026854846545f7b1618ba52048bf13db61dd9a4d722b45231f7abcddcffb320a5c5849" -&gt; (known after apply)
      ~ id                   = "923a23b97f6dc5e555699ae9515c52886329bb01" -&gt; (known after apply)
        # (3 unchanged attributes hidden)
    }</p>
<p>Plan: 4 to add, 2 to change, 4 to destroy.</p>
<p>Changes to Outputs:
  ~ server_datacenter = "hel1-dc2" -&gt; (known after apply)
  ~ server_ip         = "95.216.223.223" -&gt; (known after apply)</p>
<p>Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.</p>
<p>Enter a value: yes</p>
<p>hcloud_volume_attachment.exercise_volume_attachment: Destroying... [id=103002948]
hcloud_firewall_attachment.exercise_fw_attachment: Destroying... [id=2324824]
hcloud_firewall_attachment.exercise_fw_attachment: Destruction complete after 2s
hcloud_volume_attachment.exercise_volume_attachment: Destruction complete after 4s
hcloud_server.exercise_20: Destroying... [id=105771291]
hcloud_server.exercise_20: Destruction complete after 8s
local_file.cloud_init: Destroying... [id=923a23b97f6dc5e555699ae9515c52886329bb01]
local_file.cloud_init: Destruction complete after 0s
local_file.cloud_init: Creating...
local_file.cloud_init: Creation complete after 0s [id=6bd71fdc395ac3d3dd94c75297cae1e359bb58ad]
hcloud_server.exercise_20: Creating...
hcloud_server.exercise_20: Still creating... [00m10s elapsed]
hcloud_server.exercise_20: Creation complete after 12s [id=105772030]
hcloud_volume_attachment.exercise_volume_attachment: Creating...
hcloud_firewall_attachment.exercise_fw_attachment: Creating...
hcloud_firewall_attachment.exercise_fw_attachment: Creation complete after 2s [id=2324824]
hcloud_volume_attachment.exercise_volume_attachment: Creation complete after 8s [id=103002948]</p>
<p>Apply complete! Resources: 4 added, 0 changed, 4 destroyed.</p>
<p>Outputs:</p>
<p>server_datacenter = "hel1-dc2"
server_ip = "95.216.223.223"
volume_device = "/dev/disk/by-id/scsi-0HC_Volume_103002948"
dwalz@dwolf:/mnt/d/Development/hdm/ss25/sdi/exercise22/configuration$</p>
<p>$ ./bin/ssh.sh
Linux exercise-20 6.1.0-37-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.140-1 (2025-05-22) x86_64</p>
<p>The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.</p>
<p>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
devops@exercise-20:~$ openssl rsa -in /etc/nginx/ssl/private.pem -noout -modulus | openssl md5
MD5(stdin)= 9b486c6d6d539a37e3b152cfbfcd1b9b
devops@exercise-20:~$ openssl x509 -in /etc/nginx/ssl/.pem -noout -modulus | openssl md5
certificate.pem  private.pem
devops@exercise-20:~$ openssl x509 -in /etc/nginx/ssl/.pem -noout -modulus | openssl md5
certificate.pem  private.pem
devops@exercise-20:~$ openssl x509 -in /etc/nginx/ssl/certificate.pem -noout -modulus | openssl md5
MD5(stdin)= 9b486c6d6d539a37e3b152cfbfcd1b9b
devops@exercise-20:~$ sudo nano /etc/nginx/sites-available/default
devops@exercise-20:~$ sudo nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
devops@exercise-20:~$ systemctl restart nginx
Failed to execute /usr/bin/pkttyagent: No such file or directory
Failed to restart nginx.service: Access denied
See system logs and 'systemctl status nginx.service' for details.
devops@exercise-20:~$ sudo systemctl restart nginx
devops@exercise-20:~$ sudo systemctl status nginx
● nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; preset: enabled)
     Active: active (running) since Fri 2025-08-01 14:20:14 UTC; 6s ago
       Docs: man:nginx(8)
    Process: 2517 ExecStartPre=/usr/sbin/nginx -t -q -g daemon on; master_process on; (code=exited, status=0/SUCCESS)
    Process: 2518 ExecStart=/usr/sbin/nginx -g daemon on; master_process on; (code=exited, status=0/SUCCESS)
   Main PID: 2519 (nginx)
      Tasks: 3 (limit: 2250)
     Memory: 2.7M
        CPU: 15ms
     CGroup: /system.slice/nginx.service
             ├─2519 "nginx: master process /usr/sbin/nginx -g daemon on; master_process on;"
             ├─2520 "nginx: worker process"
             └─2521 "nginx: worker process"</p>
<p>Aug 01 14:20:14 exercise-20 systemd[1]: Starting nginx.service - A high performance web server and a reverse proxy server...
Aug 01 14:20:14 exercise-20 systemd[1]: Started nginx.service - A high performance web server and a reverse proxy server.
devops@exercise-20:~$ exit
logout
Connection to workhorse.g2.sdi.hdm-stuttgart.cloud closed.</p>
<p>dwalz@dwolf:/mnt/d/Development/hdm/ss25/sdi/exercise22/configuration$ ./bin/ssh.sh
Linux exercise-20 6.1.0-37-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.140-1 (2025-05-22) x86_64</p>
<p>The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.</p>
<p>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Fri Aug  1 14:16:22 2025 from 91.16.131.250
devops@exercise-20:~$ cat /
bin/            dev/            home/           initrd.img.old  lib64/          media/          opt/            root/           sbin/           sys/            usr/            vmlinuz         volume01/
boot/           etc/            initrd.img      lib/            lost+found/     mnt/            proc/           run/            srv/            tmp/            var/            vmlinuz.old
devops@exercise-20:~$ cat /
bin/            dev/            home/           initrd.img.old  lib64/          media/          opt/            root/           sbin/           sys/            usr/            vmlinuz         volume01/
boot/           etc/            initrd.img      lib/            lost+found/     mnt/            proc/           run/            srv/            tmp/            var/            vmlinuz.old
devops@exercise-20:~$ cat /etc/nginx/sites-available/default</p>
<h2 id="_14"></h2>
<h1 id="you-should-look-at-the-following-urls-in-order-to-grasp-a-solid-understanding_1">You should look at the following URL's in order to grasp a solid understanding</h1>
<h1 id="of-nginx-configuration-files-in-order-to-fully-unleash-the-power-of-nginx_1">of Nginx configuration files in order to fully unleash the power of Nginx.</h1>
<h1 id="httpswwwnginxcomresourceswikistart_1">https://www.nginx.com/resources/wiki/start/</h1>
<h1 id="httpswwwnginxcomresourceswikistarttopicstutorialsconfig_pitfalls_1">https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/</h1>
<h1 id="httpswikidebianorgnginxdirectorystructure_1">https://wiki.debian.org/Nginx/DirectoryStructure</h1>
<h1 id="_15"></h1>
<h1 id="in-most-cases-administrators-will-remove-this-file-from-sites-enabled-and_1">In most cases, administrators will remove this file from sites-enabled/ and</h1>
<h1 id="leave-it-as-reference-inside-of-sites-available-where-it-will-continue-to-be_1">leave it as reference inside of sites-available where it will continue to be</h1>
<h1 id="updated-by-the-nginx-packaging-team_1">updated by the nginx packaging team.</h1>
<h1 id="_16"></h1>
<h1 id="this-file-will-automatically-load-configuration-files-provided-by-other_1">This file will automatically load configuration files provided by other</h1>
<h1 id="applications-such-as-drupal-or-wordpress-these-applications-will-be-made_1">applications, such as Drupal or Wordpress. These applications will be made</h1>
<h1 id="available-underneath-a-path-with-that-package-name-such-as-drupal8_1">available underneath a path with that package name, such as /drupal8.</h1>
<h1 id="_17"></h1>
<h1 id="please-see-usrsharedocnginx-docexamples-for-more-detailed-examples_1">Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.</h1>
<h2 id="_18"></h2>
<h1 id="default-server-configuration_1">Default server configuration</h1>
<h1 id="_19"></h1>
<p>server {
        listen 80 default_server;
        listen [::]:80 default_server;</p>
<pre><code>    # SSL configuration
    #
    listen 443 ssl default_server;
    listen [::]:443 ssl default_server;

    ssl_certificate /etc/nginx/ssl/certificate.pem;
    ssl_certificate_key /etc/nginx/ssl/private.pem;
    #
    # Note: You should disable gzip for SSL traffic.
    # See: https://bugs.debian.org/773332
    #
    # Read up on ssl_ciphers to ensure a secure configuration.
    # See: https://bugs.debian.org/765782
    #
    # Self signed certs generated by the ssl-cert package
    # Don't use them in a production server!
    #
    # include snippets/snakeoil.conf;

    root /var/www/html;

    # Add index.php to the list if you are using PHP
    index index.html index.htm index.nginx-debian.html;

    server_name _;

    location / {
            # First attempt to serve request as file, then
            # as directory, then fall back to displaying a 404.
            try_files $uri $uri/ =404;
    }

    # pass PHP scripts to FastCGI server
    #
    #location ~ \.php$ {
    #       include snippets/fastcgi-php.conf;
    #
    #       # With php-fpm (or other unix sockets):
    #       fastcgi_pass unix:/run/php/php7.4-fpm.sock;
    #       # With php-cgi (or other tcp sockets):
    #       fastcgi_pass 127.0.0.1:9000;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #       deny all;
    #}
</code></pre>
<p>}</p>
<h1 id="virtual-host-configuration-for-examplecom_1">Virtual Host configuration for example.com</h1>
<h1 id="_20"></h1>
<h1 id="you-can-move-that-to-a-different-file-under-sites-available-and-symlink-that_1">You can move that to a different file under sites-available/ and symlink that</h1>
<h1 id="to-sites-enabled-to-enable-it_1">to sites-enabled/ to enable it.</h1>
<h1 id="_21"></h1>
<h1 id="server_1">server {</h1>
<h1 id="listen-80_2">listen 80;</h1>
<h1 id="listen-80_3">listen [::]:80;</h1>
<h1 id="_22"></h1>
<h1 id="server_name-examplecom_1">server_name example.com;</h1>
<h1 id="_23"></h1>
<h1 id="root-varwwwexamplecom_1">root /var/www/example.com;</h1>
<h1 id="index-indexhtml_1">index index.html;</h1>
<h1 id="_24"></h1>
<h1 id="location_1">location / {</h1>
<h1 id="try_files-uri-uri-404_1">try_files $uri $uri/ =404;</h1>
<h1 id="_25">}</h1>
<h1 id="_26">}</h1>
<p>devops@exercise-20:~$</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../exercise21/" class="btn btn-neutral float-left" title="Exercise 21"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../exercise23/" class="btn btn-neutral float-right" title="Exercise 23">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../exercise21/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../exercise23/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
